# Cargamos las bibliotecas necesarias
library(foreign)
library(doBy)
library(reldist)
library(survey)
library(sf)
library(ggspatial)
library(tidyverse)
library(RColorBrewer)
library(cowplot)

# Establecemos la ruta del archivo CSV
ruta_archivo22 <- "D:/52556/Documents/ENIGH 22/Historicos/concentradohogar_22.csv"
ruta_archivo20 <- "D:/52556/Documents/ENIGH 22/Historicos/concentradohogar_20.csv"
ruta_archivo18 <- "D:/52556/Documents/ENIGH 22/Historicos/concentradohogar_18.csv"

# Cargamos el archivo CSV en el dataframe Conc
Conc22 <- read.csv(ruta_archivo22)
Conc20 <- read.csv(ruta_archivo20)
Conc18 <- read.csv(ruta_archivo18)

# Eliminamos las comas de la columna ubica_geo
Conc22$ubica_geo <- gsub(",", "", Conc22$ubica_geo)
Conc20$ubica_geo <- gsub(",", "", Conc20$ubica_geo)
Conc18$ubica_geo <- gsub(",", "", Conc18$ubica_geo)

# Creamos una función que devuelva el primer o los dos primeros dígitos de un número
extraer_digitos <- function(x) {
    if (nchar(x) == 4) {
        return(substr(x, 1, 1))
    } else if (nchar(x) == 5) {
        return(substr(x, 1, 2))
    } else {
        return(NA)
    }
}

# Aplicamos la función a la columna ubica_geo y creamos una nueva columna con el resultado
Conc22$entidad <- sapply(Conc22$ubica_geo, extraer_digitos)
Conc20$entidad <- sapply(Conc20$ubica_geo, extraer_digitos)
Conc18$entidad <- sapply(Conc18$ubica_geo, extraer_digitos)

# Definimos los nombres de las entidades federativas
nombres <- c("AGUASCALIENTES", "BAJA CALIFORNIA", "BAJA CALIFORNIA SUR", "CAMPECHE", "COAHUILA", "COLIMA", "CHIAPAS", "CHIHUAHUA", "CIUDAD DE MEXICO", "DURANGO", "GUANAJUATO", "GUERRERO", "HIDALGO", "JALISCO", "MEXICO", "MICHOACAN", "MORELOS", "NAYARIT", "NUEVO LEON", "OAXACA", "PUEBLA", "QUERETARO", "QUINTANA ROO", "SAN LUIS POTOSI", "SINALOA", "SONORA", "TABASCO", "TAMAULIPAS", "TLAXCALA", "VERACRUZ", "YUCATAN", "ZACATECAS")

# Creamos una nueva columna llamada NOMBRE con los nombres de las entidades usando mutate y factor
Conc22 <- Conc22 %>%
    mutate(NOMBRE = factor(entidad, levels = 1:32, labels = nombres))
Conc20 <- Conc20 %>%
    mutate(NOMBRE = factor(entidad, levels = 1:32, labels = nombres))
Conc18 <- Conc18 %>%
    mutate(NOMBRE = factor(entidad, levels = 1:32, labels = nombres))

# Definir los rangos de edad por generación
babyboomers22 <- 58:76 # nacidos entre 1946 y 1964
generacionx22 <- 42:57 # nacidos entre 1965 y 1980
millennials22 <- 26:41 # nacidos entre 1981 y 1996
generacionz22 <- 10:25 # nacidos entre 1997 y 2012

babyboomers20 <- 56:74 # nacidos entre 1946 y 1964
generacionx20 <- 40:55 # nacidos entre 1965 y 1980
millennials20 <- 24:39 # nacidos entre 1981 y 1996
generacionz20 <- 8:23 # nacidos entre 1997 y 2012

babyboomers18 <- 53:72 # nacidos entre 1946 y 1964
generacionx18 <- 38:53 # nacidos entre 1965 y 1980
millennials18 <- 23:37 # nacidos entre 1981 y 1996
generacionz18 <- 6:21 # nacidos entre 1997 y 2012

# Creamos una variable que indique la generación a la que pertenece cada integrante del hogar
Conc22$generacion <- NA # inicializamos la variable con valores faltantes
Conc22$generacion[Conc22$edad %in% babyboomers22] <- "Baby Boomers" # asignamos la categoría Baby Boomers
Conc22$generacion[Conc22$edad %in% generacionx22] <- "Generación X" # asignamos la categoría Generación X
Conc22$generacion[Conc22$edad %in% millennials22] <- "Millennials" # asignamos la categoría Millennials
Conc22$generacion[Conc22$edad %in% generacionz22] <- "Generación Z" # asignamos la categoría Generación Z

Conc20$generacion <- NA # inicializamos la variable con valores faltantes
Conc20$generacion[Conc20$edad %in% babyboomers20] <- "Baby Boomers" # asignamos la categoría Baby Boomers
Conc20$generacion[Conc20$edad %in% generacionx20] <- "Generación X" # asignamos la categoría Generación X
Conc20$generacion[Conc20$edad %in% millennials20] <- "Millennials" # asignamos la categoría Millennials
Conc20$generacion[Conc20$edad %in% generacionz20] <- "Generación Z" # asignamos la categoría Generación Z

Conc18$generacion <- NA # inicializamos la variable con valores faltantes
Conc18$generacion[Conc18$edad %in% babyboomers18] <- "Baby Boomers" # asignamos la categoría Baby Boomers
Conc18$generacion[Conc18$edad %in% generacionx18] <- "Generación X" # asignamos la categoría Generación X
Conc18$generacion[Conc18$edad %in% millennials18] <- "Millennials" # asignamos la categoría Millennials
Conc18$generacion[Conc18$edad %in% generacionz18] <- "Generación Z" # asignamos la categoría Generación Z

# Seleccionamos las variables de interés, incluyendo las nuevas variables
Conc22 <- Conc22[c("foliohog", "ing_cor", "factor", "ingtrab", "trabajo", "negocio",
"otros_trab" ,"rentas", "transfer", "estim_alqu", "otros_ing", "jubilacion", "becas", "donativos", "remesas", "bene_gob", "transf_hog", "trans_inst","generacion", "NOMBRE")]

Conc20 <- Conc20[c("foliohog", "ing_cor", "factor", "ingtrab", "trabajo", "negocio",
"otros_trab" ,"rentas", "transfer", "estim_alqu", "otros_ing", "jubilacion", "becas", "donativos", "remesas", "bene_gob", "transf_hog", "trans_inst","generacion", "NOMBRE")]

Conc18 <- Conc18[c("foliohog", "ing_cor", "factor", "ingtrab", "trabajo", "negocio",
"otros_trab" ,"rentas", "transfer", "estim_alqu", "otros_ing", "jubilacion", "becas", "donativos", "remesas", "bene_gob", "transf_hog", "trans_inst","generacion", "NOMBRE")]

# Ordenamos Conc de acuerdo a ing_cor, foliohog
Conc22 <- orderBy(~ +ing_cor + foliohog, data = Conc22)
Conc20 <- orderBy(~ +ing_cor + foliohog, data = Conc20)
Conc18 <- orderBy(~ +ing_cor + foliohog, data = Conc18)

# Sumamos todos los factores y guardamos el valor en el vector tot_hogares
tot_hogares22 <- sum(Conc22$factor)
tot_hogares20 <- sum(Conc20$factor)
tot_hogares18 <- sum(Conc18$factor)

# Dividimos la suma de factores entre diez para obtener el tamaño del decil
tam_dec22 <- trunc(tot_hogares22 / 10)
tam_dec20 <- trunc(tot_hogares20 / 10)
tam_dec18 <- trunc(tot_hogares18 / 10)

# Mostramos la suma del factor en variable hogar
Conc22$tam_dec22 <- tam_dec22
Conc20$tam_dec20 <- tam_dec20
Conc18$tam_dec18 <- tam_dec18

# Creamos deciles de hogares
BD22 <- Conc22
BD22$MAXT <- BD22$ing_cor
BD22 <- BD22[with(BD22, order(rank(MAXT))),]
BD22$ACUMULA <- cumsum(BD22$factor)
for (i in 1:9) {
    a22 <- BD22[dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1] + 1,]$factor
    BD22 <- rbind(BD22[1:(dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1] + 1),],
                 BD22[(dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1] + 1):dim(BD22)[1],])
    b22<- tam_dec22 * i - BD22[dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1],]$ACUMULA
    BD22[(dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1] + 1),]$factor <- b22
    BD22[(dim(BD22[BD22$ACUMULA < tam_dec22 * i,])[1] + 2),]$factor <- (a22 - b22)
}
BD22$ACUMULA2 <- cumsum(BD22$factor)
BD22$DECIL <- 0
BD22[(BD22$ACUMULA2 <= tam_dec22),]$DECIL <- 1
for (i in 1:9) {
    BD22[((BD22$ACUMULA2 > tam_dec22 * i) & (BD22$ACUMULA2 <= tam_dec22 * (i + 1))),]$DECIL <- (i + 1)
}
BD22[BD22$DECIL %in% "0",]$DECIL <- 10

BD20 <- Conc20
BD20$MAXT <- BD20$ing_cor
BD20 <- BD20[with(BD20, order(rank(MAXT))),]
BD20$ACUMULA <- cumsum(BD20$factor)
for (i in 1:9) {
    a20 <- BD20[dim(BD20[BD20$ACUMULA < tam_dec20 * i,])[1] + 1,]$factor
    BD20 <- rbind(BD20[1:(dim(BD20[BD20$ACUMULA < tam_dec20 * i,])[1] + 1),],
                 BD20[(dim(BD20[BD20$ACUMULA < tam_dec20 * i,])[1] + 1):dim(BD20)[1],])
    b20 <- tam_dec20 * i - BD20[dim(BD20[BD20$ACUMULA < tam_dec20 * i,])[1],]$ACUMULA
    BD20[(dim(BD20[BD20$ACUMULA < tam_dec20 * i,])[1] + 1),]$factor <- b20
    BD20[(dim(BD22[BD20$ACUMULA < tam_dec20 * i,])[1] + 2),]$factor <- (a20 - b20)
}
BD20$ACUMULA2 <- cumsum(BD20$factor)
BD20$DECIL <- 0
BD20[(BD20$ACUMULA2 <= tam_dec20),]$DECIL <- 1
for (i in 1:9) {
    BD20[((BD20$ACUMULA2 > tam_dec20 * i) & (BD20$ACUMULA2 <= tam_dec20 * (i + 1))),]$DECIL <- (i + 1)
}
BD20[BD20$DECIL %in% "0",]$DECIL <- 10


BD18 <- Conc18
BD18$MAXT <- BD18$ing_cor
BD18 <- BD18[with(BD18, order(rank(MAXT))),]
BD18$ACUMULA <- cumsum(BD18$factor)
for (i in 1:9) {
    a18 <- BD18[dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1] + 1,]$factor
    BD18 <- rbind(BD18[1:(dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1] + 1),],
                 BD18[(dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1] + 1):dim(BD18)[1],])
    b18 <- tam_dec18 * i - BD18[dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1],]$ACUMULA
    BD18[(dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1] + 1),]$factor <- b18
    BD18[(dim(BD18[BD18$ACUMULA < tam_dec18 * i,])[1] + 2),]$factor <- (a18 - b18)
}
BD18$ACUMULA2 <- cumsum(BD18$factor)
BD18$DECIL <- 0
BD18[(BD18$ACUMULA2 <= tam_dec18),]$DECIL <- 1
for (i in 1:9) {
    BD18[((BD18$ACUMULA2 > tam_dec18 * i) & (BD18$ACUMULA2 <= tam_dec18 * (i + 1))),]$DECIL <- (i + 1)
}
BD18[BD18$DECIL %in% "0",]$DECIL <- 10


# Total de hogares
x22 <- tapply(BD22$factor, BD22$foliohog, sum)
x20 <- tapply(BD20$factor, BD20$foliohog, sum)
x18 <- tapply(BD18$factor, BD18$foliohog, sum)

# Deciles
y22 <- tapply(BD22$factor, BD22$DECIL, sum)
y20 <- tapply(BD20$factor, BD20$DECIL, sum)
y18 <- tapply(BD18$factor, BD18$DECIL, sum)

# Se calcula el promedio de ingreso corriente para el total
prom_ing_cor_total22 <- sum(BD22$factor * BD22$ing_cor) / tot_hogares22
prom_ing_cor_total20 <- sum(BD20$factor * BD20$ing_cor) / tot_hogares20
prom_ing_cor_total18 <- sum(BD18$factor * BD18$ing_cor) / tot_hogares18

# Se calcula el promedio de ingreso corriente por componente para el total
prom_ingtrab_total22 <- sum(BD22$factor * BD22$ingtrab) / tot_hogares22
prom_rentas_total22 <- sum(BD22$factor * BD22$rentas) / tot_hogares22
prom_transfer_total22 <- sum(BD22$factor * BD22$transfer) / tot_hogares22
prom_estim_alqu_total22 <- sum(BD22$factor * BD22$estim_alqu) / tot_hogares22
prom_otros_ing_total22 <- sum(BD22$factor * BD22$otros_ing) / tot_hogares22
prom_trabajo_total22 <- sum(BD22$factor * BD22$trabajo) / tot_hogares22
prom_negocio_total22 <- sum(BD22$factor * BD22$negocio) / tot_hogares22
prom_otrab_total22 <- sum(BD22$factor * BD22$otros_trab) / tot_hogares22

prom_ingtrab_total20 <- sum(BD20$factor * BD20$ingtrab) / tot_hogares20
prom_rentas_total20 <- sum(BD20$factor * BD20$rentas) / tot_hogares20
prom_transfer_total20 <- sum(BD20$factor * BD20$transfer) / tot_hogares20
prom_estim_alqu_total20 <- sum(BD20$factor * BD20$estim_alqu) / tot_hogares20
prom_otros_ing_total20 <- sum(BD20$factor * BD20$otros_ing) / tot_hogares20
prom_trabajo_total20 <- sum(BD20$factor * BD20$trabajo) / tot_hogares20
prom_negocio_total20 <- sum(BD20$factor * BD20$negocio) / tot_hogares20
prom_otrab_total20 <- sum(BD20$factor * BD20$otros_trab) / tot_hogares20

prom_ingtrab_total18 <- sum(BD18$factor * BD18$ingtrab) / tot_hogares18
prom_rentas_total18 <- sum(BD18$factor * BD18$rentas) / tot_hogares18
prom_transfer_total18 <- sum(BD18$factor * BD18$transfer) / tot_hogares18
prom_estim_alqu_total18 <- sum(BD18$factor * BD18$estim_alqu) / tot_hogares18
prom_otros_ing_total18 <- sum(BD18$factor * BD18$otros_ing) / tot_hogares18
prom_trabajo_total18 <- sum(BD18$factor * BD18$trabajo) / tot_hogares18
prom_negocio_total18 <- sum(BD18$factor * BD18$negocio) / tot_hogares18
prom_otrab_total18 <- sum(BD18$factor * BD18$otros_trab) / tot_hogares18

# Calculamos el promedio de ingreso corriente para cada entidad
prom_ing_cor_entidades22 <- tapply(BD22$factor * BD22$ing_cor, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_ing_cor_entidades20 <- tapply(BD20$factor * BD20$ing_cor, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_ing_cor_entidades18 <- tapply(BD18$factor * BD18$ing_cor, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)

# Calculamos el promedio de ingreso por componente para cada entidad
prom_ingtrab_entidades22 <- tapply(BD22$factor * BD22$ingtrab, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_rentas_entidades22 <- tapply(BD22$factor * BD22$rentas, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_transfer_entidades22 <- tapply(BD22$factor * BD22$transfer, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_estim_alqu_entidades22 <- tapply(BD22$factor * BD22$estim_alqu, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_otros_ing_entidades22 <- tapply(BD22$factor * BD22$otros_ing, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_trabajo_ing_entidades22 <- tapply(BD22$factor * BD22$trabajo, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_negocio_ing_entidades22 <- tapply(BD22$factor * BD22$negocio, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)
prom_otrab_ing_entidades22 <- tapply(BD22$factor * BD22$otros_trab, BD22$NOMBRE, sum) / tapply(BD22$factor, BD22$NOMBRE, sum)

prom_ingtrab_entidades20 <- tapply(BD20$factor * BD20$ingtrab, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_rentas_entidades20 <- tapply(BD20$factor * BD20$rentas, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_transfer_entidades20 <- tapply(BD20$factor * BD20$transfer, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_estim_alqu_entidades20 <- tapply(BD20$factor * BD20$estim_alqu, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_otros_ing_entidades20 <- tapply(BD20$factor * BD20$otros_ing, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_trabajo_ing_entidades20 <- tapply(BD20$factor * BD20$trabajo, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_negocio_ing_entidades20 <- tapply(BD20$factor * BD20$negocio, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)
prom_otrab_ing_entidades20 <- tapply(BD20$factor * BD20$otros_trab, BD20$NOMBRE, sum) / tapply(BD20$factor, BD20$NOMBRE, sum)

prom_ingtrab_entidades18 <- tapply(BD18$factor * BD18$ingtrab, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_rentas_entidades18 <- tapply(BD18$factor * BD18$rentas, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_transfer_entidades18 <- tapply(BD18$factor * BD18$transfer, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_estim_alqu_entidades18 <- tapply(BD18$factor * BD18$estim_alqu, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_otros_ing_entidades18 <- tapply(BD18$factor * BD18$otros_ing, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_trabajo_ing_entidades18 <- tapply(BD18$factor * BD18$trabajo, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_negocio_ing_entidades18 <- tapply(BD18$factor * BD18$negocio, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)
prom_otrab_ing_entidades18 <- tapply(BD18$factor * BD18$otros_trab, BD18$NOMBRE, sum) / tapply(BD18$factor, BD18$NOMBRE, sum)

# Guardamos los resultados en un data frame
promedios_nacional22 <- data.frame(
    NOMBRE = "Total",
    PROM_ING_COR = prom_ing_cor_total22,
    PROM_ING_TRAB = prom_ingtrab_total22,
    PROM_RENTAS = prom_rentas_total22,
    PROM_TRANSFER = prom_transfer_total22,
    PROM_ESTIM_ALQU = prom_estim_alqu_total22,
    PROM_OTROS_ING = prom_otros_ing_total22,
    PROM_TRABAJO_ING = prom_trabajo_total22,
    PROM_NEGOCIO_ING = prom_negocio_total22,
    PROM_OTRAB_ING = prom_otrab_total22
)

promedios_por_entidad22 <- data.frame(
    NOMBRE = nombres,
    PROM_ING_COR = prom_ing_cor_entidades22,
    PROM_ING_TRAB = prom_ingtrab_entidades22,
    PROM_RENTAS = prom_rentas_entidades22,
    PROM_TRANSFER = prom_transfer_entidades22,
    PROM_ESTIM_ALQU = prom_estim_alqu_entidades22,
    PROM_OTROS_ING = prom_otros_ing_entidades22,
    PROM_TRABAJO_ING = prom_trabajo_ing_entidades22,
    PROM_NEGOCIO_ING = prom_negocio_ing_entidades22,
    PROM_OTRAB_ING = prom_otrab_ing_entidades22
)

promedios_nacional20 <- data.frame(
    NOMBRE = "Total",
    PROM_ING_COR = prom_ing_cor_total20,
    PROM_ING_TRAB = prom_ingtrab_total20,
    PROM_RENTAS = prom_rentas_total20,
    PROM_TRANSFER = prom_transfer_total20,
    PROM_ESTIM_ALQU = prom_estim_alqu_total20,
    PROM_OTROS_ING = prom_otros_ing_total20,
    PROM_TRABAJO_ING = prom_trabajo_total20,
    PROM_NEGOCIO_ING = prom_negocio_total20,
    PROM_OTRAB_ING = prom_otrab_total20
)

promedios_por_entidad20 <- data.frame(
    NOMBRE = nombres,
    PROM_ING_COR = prom_ing_cor_entidades20,
    PROM_ING_TRAB = prom_ingtrab_entidades20,
    PROM_RENTAS = prom_rentas_entidades20,
    PROM_TRANSFER = prom_transfer_entidades20,
    PROM_ESTIM_ALQU = prom_estim_alqu_entidades20,
    PROM_OTROS_ING = prom_otros_ing_entidades20,
    PROM_TRABAJO_ING = prom_trabajo_ing_entidades20,
    PROM_NEGOCIO_ING = prom_negocio_ing_entidades20,
    PROM_OTRAB_ING = prom_otrab_ing_entidades20
)
promedios_nacional18 <- data.frame(
    NOMBRE = "Total",
    PROM_ING_COR = prom_ing_cor_total18,
    PROM_ING_TRAB = prom_ingtrab_total18,
    PROM_RENTAS = prom_rentas_total18,
    PROM_TRANSFER = prom_transfer_total18,
    PROM_ESTIM_ALQU = prom_estim_alqu_total18,
    PROM_OTROS_ING = prom_otros_ing_total18,
    PROM_TRABAJO_ING = prom_trabajo_total18,
    PROM_NEGOCIO_ING = prom_negocio_total18,
    PROM_OTRAB_ING = prom_otrab_total18
)

promedios_por_entidad18 <- data.frame(
    NOMBRE = nombres,
    PROM_ING_COR = prom_ing_cor_entidades18,
    PROM_ING_TRAB = prom_ingtrab_entidades18,
    PROM_RENTAS = prom_rentas_entidades18,
    PROM_TRANSFER = prom_transfer_entidades18,
    PROM_ESTIM_ALQU = prom_estim_alqu_entidades18,
    PROM_OTROS_ING = prom_otros_ing_entidades18,
    PROM_TRABAJO_ING = prom_trabajo_ing_entidades18,
    PROM_NEGOCIO_ING = prom_negocio_ing_entidades18,
    PROM_OTRAB_ING = prom_otrab_ing_entidades18
)

# Creamos una nueva columna para el decil de cada hogar
BD22$DECIL <- cut(BD22$ACUMULA2, breaks = quantile(BD22$ACUMULA2, probs = seq(0, 1, by = 0.1)), labels = FALSE)
BD20$DECIL <- cut(BD20$ACUMULA2, breaks = quantile(BD20$ACUMULA2, probs = seq(0, 1, by = 0.1)), labels = FALSE)
BD18$DECIL <- cut(BD18$ACUMULA2, breaks = quantile(BD18$ACUMULA2, probs = seq(0, 1, by = 0.1)), labels = FALSE)

# Función para calcular el promedio por decil y entidad
calcular_promedio_por_decil <- function(data, variable) {
    promedios_decil <- tapply(data$factor * data[[variable]], list(data$NOMBRE, data$DECIL), sum) /
        tapply(data$factor, list(data$NOMBRE, data$DECIL), sum)
    promedios_decil[is.nan(promedios_decil)] <- NA
    return(as.data.frame(promedios_decil))
}

# Calcular los promedios por decil para cada variable de interés
promedios_ing_cor_decil22 <- calcular_promedio_por_decil(BD22, "ing_cor")
promedios_ing_trab_decil22 <- calcular_promedio_por_decil(BD22, "ingtrab")
promedios_rentas_decil22 <- calcular_promedio_por_decil(BD22, "rentas")
promedios_transfer_decil22 <- calcular_promedio_por_decil(BD22, "transfer")
promedios_estim_alqu_decil22 <- calcular_promedio_por_decil(BD22, "estim_alqu")
promedios_otros_ing_decil22 <- calcular_promedio_por_decil(BD22, "otros_ing")
promedios_trabajo_ing_decil22 <- calcular_promedio_por_decil(BD22, "trabajo")
promedios_negocio_ing_decil22 <- calcular_promedio_por_decil(BD22, "negocio")
promedios_otrab_ing_decil22 <- calcular_promedio_por_decil(BD22, "otros_trab")

promedios_ing_cor_decil20 <- calcular_promedio_por_decil(BD20, "ing_cor")
promedios_ing_trab_decil20 <- calcular_promedio_por_decil(BD20, "ingtrab")
promedios_rentas_decil20 <- calcular_promedio_por_decil(BD20, "rentas")
promedios_transfer_decil20 <- calcular_promedio_por_decil(BD20, "transfer")
promedios_estim_alqu_decil20 <- calcular_promedio_por_decil(BD20, "estim_alqu")
promedios_otros_ing_decil20 <- calcular_promedio_por_decil(BD20, "otros_ing")
promedios_trabajo_ing_decil20 <- calcular_promedio_por_decil(BD20, "trabajo")
promedios_negocio_ing_decil20 <- calcular_promedio_por_decil(BD20, "negocio")
promedios_otrab_ing_decil20 <- calcular_promedio_por_decil(BD20, "otros_trab")

# Calcular los promedios por decil para cada variable de interés
promedios_ing_cor_decil18 <- calcular_promedio_por_decil(BD18, "ing_cor")
promedios_ing_trab_decil18 <- calcular_promedio_por_decil(BD18, "ingtrab")
promedios_rentas_decil18 <- calcular_promedio_por_decil(BD18, "rentas")
promedios_transfer_decil18 <- calcular_promedio_por_decil(BD18, "transfer")
promedios_estim_alqu_decil18 <- calcular_promedio_por_decil(BD18, "estim_alqu")
promedios_otros_ing_decil18 <- calcular_promedio_por_decil(BD18, "otros_ing")
promedios_trabajo_ing_decil18 <- calcular_promedio_por_decil(BD18, "trabajo")
promedios_negocio_ing_decil18 <- calcular_promedio_por_decil(BD18, "negocio")
promedios_otrab_ing_decil18 <- calcular_promedio_por_decil(BD18, "otros_trab")

# Cambiar los nombres de las columnas para que indiquen el decil22
colnames(promedios_ing_cor_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_ing_trab_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_rentas_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_transfer_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_estim_alqu_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otros_ing_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_trabajo_ing_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_negocio_ing_decil22) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otrab_ing_decil22) <- paste("DECIL", 1:10, sep = "_")

colnames(promedios_ing_cor_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_ing_trab_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_rentas_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_transfer_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_estim_alqu_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otros_ing_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_trabajo_ing_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_negocio_ing_decil20) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otrab_ing_decil20) <- paste("DECIL", 1:10, sep = "_")

colnames(promedios_ing_cor_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_ing_trab_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_rentas_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_transfer_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_estim_alqu_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otros_ing_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_trabajo_ing_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_negocio_ing_decil18) <- paste("DECIL", 1:10, sep = "_")
colnames(promedios_otrab_ing_decil18) <- paste("DECIL", 1:10, sep = "_")

# Unir los promedios por decil para cada variable
promedios_por_entidad_decil22 <- cbind(promedios_por_entidad22, promedios_ing_cor_decil22, promedios_ing_trab_decil22, promedios_rentas_decil22, promedios_transfer_decil22,promedios_estim_alqu_decil22, promedios_otros_ing_decil22,promedios_trabajo_ing_decil22,promedios_negocio_ing_decil22,promedios_otrab_ing_decil22)
promedios_por_entidad_decil20 <- cbind(promedios_por_entidad20, promedios_ing_cor_decil20, promedios_ing_trab_decil20, promedios_rentas_decil20, promedios_transfer_decil20,promedios_estim_alqu_decil20, promedios_otros_ing_decil20,promedios_trabajo_ing_decil20,promedios_negocio_ing_decil20,promedios_otrab_ing_decil20)
promedios_por_entidad_decil18 <- cbind(promedios_por_entidad18, promedios_ing_cor_decil18, promedios_ing_trab_decil18, promedios_rentas_decil18, promedios_transfer_decil18,promedios_estim_alqu_decil18, promedios_otros_ing_decil18,promedios_trabajo_ing_decil18,promedios_negocio_ing_decil18,promedios_otrab_ing_decil18)

# Función para calcular los promedios por decil para cada variable adicional
calcular_promedios_por_variable_adicional_decil <- function(data, variable_adicional) {
    promedios_decil <- calcular_promedio_por_decil(data, variable_adicional)
    colnames(promedios_decil) <- paste(variable_adicional, colnames(promedios_decil), sep = "_")
    return(promedios_decil)
}

# Calcular los promedios por decil para cada variable adicional
promedios_jubilacion_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "jubilacion")
promedios_becas_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "becas")
promedios_donativos_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "donativos")
promedios_remesas_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "remesas")
promedios_bene_gob_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "bene_gob")
promedios_transf_hog_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "transf_hog")
promedios_trans_inst_decil22 <- calcular_promedios_por_variable_adicional_decil(BD22, "trans_inst")

promedios_jubilacion_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "jubilacion")
promedios_becas_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "becas")
promedios_donativos_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "donativos")
promedios_remesas_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "remesas")
promedios_bene_gob_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "bene_gob")
promedios_transf_hog_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "transf_hog")
promedios_trans_inst_decil20 <- calcular_promedios_por_variable_adicional_decil(BD20, "trans_inst")

promedios_jubilacion_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "jubilacion")
promedios_becas_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "becas")
promedios_donativos_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "donativos")
promedios_remesas_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "remesas")
promedios_bene_gob_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "bene_gob")
promedios_transf_hog_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "transf_hog")
promedios_trans_inst_decil18 <- calcular_promedios_por_variable_adicional_decil(BD18, "trans_inst")

# Unir los promedios por decil para cada variable adicional
promedios_por_entidad_decil22 <- cbind(
    promedios_por_entidad_decil22,
    promedios_jubilacion_decil22,
    promedios_becas_decil22,
    promedios_donativos_decil22,
    promedios_remesas_decil22,
    promedios_bene_gob_decil22,
    promedios_transf_hog_decil22,
    promedios_trans_inst_decil22
)

promedios_por_entidad_decil20 <- cbind(
    promedios_por_entidad_decil20,
    promedios_jubilacion_decil20,
    promedios_becas_decil20,
    promedios_donativos_decil20,
    promedios_remesas_decil20,
    promedios_bene_gob_decil20,
    promedios_transf_hog_decil20,
    promedios_trans_inst_decil20
)

# Unir los promedios por decil para cada variable adicional
promedios_por_entidad_decil18 <- cbind(
    promedios_por_entidad_decil18,
    promedios_jubilacion_decil18,
    promedios_becas_decil18,
    promedios_donativos_decil18,
    promedios_remesas_decil18,
    promedios_bene_gob_decil18,
    promedios_transf_hog_decil18,
    promedios_trans_inst_decil18
)
# Filtrar por generación
promedios_por_entidad_decil_Baby_Boomers22 <- promedios_por_entidad_decil22[promedios_por_entidad_decil22$generacion == "Baby Boomers", ]
promedios_por_entidad_decil_Generación_X22 <- promedios_por_entidad_decil22[promedios_por_entidad_decil22$generacion == "Generación X", ]
promedios_por_entidad_decil_GeneracionZ22 <- promedios_por_entidad_decil22[promedios_por_entidad_decil22$generacion == "Generación Z", ]
promedios_por_entidad_decil_Millennials22 <- promedios_por_entidad_decil22[promedios_por_entidad_decil22$generacion == "Millennials", ]

# Dataframes para cada variable adicional por generación
promedios_jubilacion_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "jubilacion")
promedios_jubilacion_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "jubilacion")
promedios_jubilacion_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "jubilacion")
promedios_jubilacion_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "jubilacion")

promedios_becas_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "becas")
promedios_becas_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "becas")
promedios_becas_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "becas")
promedios_becas_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "becas")

promedios_donativos_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "donativos")
promedios_donativos_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "donativos")
promedios_donativos_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "donativos")
promedios_donativos_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "donativos")

promedios_remesas_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "remesas")
promedios_remesas_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "remesas")
promedios_remesas_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "remesas")
promedios_remesas_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "remesas")

promedios_bene_gob_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "bene_gob")
promedios_bene_gob_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "bene_gob")
promedios_bene_gob_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "bene_gob")
promedios_bene_gob_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "bene_gob")

promedios_transf_hog_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "transf_hog")
promedios_transf_hog_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "transf_hog")
promedios_transf_hog_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "transf_hog")
promedios_transf_hog_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "transf_hog")

promedios_trans_inst_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "trans_inst")
promedios_trans_inst_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "trans_inst")
promedios_trans_inst_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "trans_inst")
promedios_trans_inst_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "trans_inst")

promedios_ing_cor_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "ing_cor")
promedios_ing_cor_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "ing_cor")
promedios_ing_cor_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "ing_cor")
promedios_ing_cor_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "ing_cor")

promedios_ingtrab_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "ingtrab")
promedios_ingtrab_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "ingtrab")
promedios_ingtrabr_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "ingtrab")
promedios_ingtrab_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "ingtrab")

promedios_trabajo_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "trabajo")
promedios_trabajo_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "trabajo")
promedios_trabajor_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "trabajo")
promedios_trabajo_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "trabajo")

promedios_negocio_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "negocio")
promedios_ingtrab_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "negocio")
promedios_ingtrabr_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "negocio")
promedios_ingtrab_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "negocio")

promedios_otrab_decil_Baby_Boomers22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Baby Boomers", ], "otros_trab")
promedios_otrab_decil_Generación_X22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación X", ], "otros_trab")
promedios_otrab_decil_GeneracionZ22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Generación Z", ], "otros_trab")
promedios_otrab_decil_Millennials22 <- calcular_promedios_por_variable_adicional_decil(BD22[BD22$generacion == "Millennials", ], "otros_trab")

# Filtrar por generación
promedios_por_entidad_decil_Baby_Boomers20 <- promedios_por_entidad_decil20[promedios_por_entidad_decil20$generacion == "Baby Boomers", ]
promedios_por_entidad_decil_Generación_X20 <- promedios_por_entidad_decil20[promedios_por_entidad_decil20$generacion == "Generación X", ]
promedios_por_entidad_decil_GeneracionZ20 <- promedios_por_entidad_decil20[promedios_por_entidad_decil20$generacion == "Generación Z", ]
promedios_por_entidad_decil_Millennials20 <- promedios_por_entidad_decil20[promedios_por_entidad_decil20$generacion == "Millennials", ]

# Dataframes para cada variable adicional por generación
promedios_jubilacion_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "jubilacion")
promedios_jubilacion_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "jubilacion")
promedios_jubilacion_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "jubilacion")
promedios_jubilacion_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "jubilacion")

promedios_becas_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "becas")
promedios_becas_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "becas")
promedios_becas_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "becas")
promedios_becas_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "becas")

promedios_donativos_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "donativos")
promedios_donativos_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "donativos")
promedios_donativos_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "donativos")
promedios_donativos_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "donativos")

promedios_remesas_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "remesas")
promedios_remesas_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "remesas")
promedios_remesas_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "remesas")
promedios_remesas_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "remesas")

promedios_bene_gob_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "bene_gob")
promedios_bene_gob_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "bene_gob")
promedios_bene_gob_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "bene_gob")
promedios_bene_gob_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "bene_gob")

promedios_transf_hog_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "transf_hog")
promedios_transf_hog_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "transf_hog")
promedios_transf_hog_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "transf_hog")
promedios_transf_hog_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "transf_hog")

promedios_trans_inst_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "trans_inst")
promedios_trans_inst_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "trans_inst")
promedios_trans_inst_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "trans_inst")
promedios_trans_inst_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "trans_inst")

promedios_ing_cor_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "ing_cor")
promedios_ing_cor_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "ing_cor")
promedios_ing_cor_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "ing_cor")
promedios_ing_cor_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "ing_cor")

promedios_ingtrab_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "ingtrab")
promedios_ingtrab_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "ingtrab")
promedios_ingtrabr_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "ingtrab")
promedios_ingtrab_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "ingtrab")

promedios_trabajo_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "trabajo")
promedios_trabajo_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "trabajo")
promedios_trabajor_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "trabajo")
promedios_trabajo_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "trabajo")

promedios_negocio_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "negocio")
promedios_ingtrab_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "negocio")
promedios_ingtrabr_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "negocio")
promedios_ingtrab_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "negocio")

promedios_otrab_decil_Baby_Boomers20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Baby Boomers", ], "otros_trab")
promedios_otrab_decil_Generación_X20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación X", ], "otros_trab")
promedios_otrab_decil_GeneracionZ20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Generación Z", ], "otros_trab")
promedios_otrab_decil_Millennials20 <- calcular_promedios_por_variable_adicional_decil(BD20[BD20$generacion == "Millennials", ], "otros_trab")
# Filtrar por generación
promedios_por_entidad_decil_Baby_Boomers18 <- promedios_por_entidad_decil18[promedios_por_entidad_decil18$generacion == "Baby Boomers", ]
promedios_por_entidad_decil_Generación_X18 <- promedios_por_entidad_decil18[promedios_por_entidad_decil18$generacion == "Generación X", ]
promedios_por_entidad_decil_GeneracionZ18 <- promedios_por_entidad_decil18[promedios_por_entidad_decil18$generacion == "Generación Z", ]
promedios_por_entidad_decil_Millennials18 <- promedios_por_entidad_decil18[promedios_por_entidad_decil18$generacion == "Millennials", ]

# Dataframes para cada variable adicional por generación
promedios_jubilacion_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "jubilacion")
promedios_jubilacion_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "jubilacion")
promedios_jubilacion_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "jubilacion")
promedios_jubilacion_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "jubilacion")

promedios_becas_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "becas")
promedios_becas_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "becas")
promedios_becas_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "becas")
promedios_becas_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "becas")

promedios_donativos_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "donativos")
promedios_donativos_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "donativos")
promedios_donativos_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "donativos")
promedios_donativos_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "donativos")

promedios_remesas_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "remesas")
promedios_remesas_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "remesas")
promedios_remesas_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "remesas")
promedios_remesas_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "remesas")

promedios_bene_gob_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "bene_gob")
promedios_bene_gob_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "bene_gob")
promedios_bene_gob_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "bene_gob")
promedios_bene_gob_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "bene_gob")

promedios_transf_hog_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "transf_hog")
promedios_transf_hog_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "transf_hog")
promedios_transf_hog_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "transf_hog")
promedios_transf_hog_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "transf_hog")

promedios_trans_inst_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "trans_inst")
promedios_trans_inst_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "trans_inst")
promedios_trans_inst_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "trans_inst")
promedios_trans_inst_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "trans_inst")

promedios_ing_cor_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "ing_cor")
promedios_ing_cor_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "ing_cor")
promedios_ing_cor_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "ing_cor")
promedios_ing_cor_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "ing_cor")

promedios_ingtrab_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "ingtrab")
promedios_ingtrab_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "ingtrab")
promedios_ingtrabr_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "ingtrab")
promedios_ingtrab_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "ingtrab")

promedios_trabajo_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "trabajo")
promedios_trabajo_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "trabajo")
promedios_trabajor_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "trabajo")
promedios_trabajo_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "trabajo")

promedios_negocio_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "negocio")
promedios_ingtrab_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "negocio")
promedios_ingtrabr_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "negocio")
promedios_ingtrab_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "negocio")

promedios_otrab_decil_Baby_Boomers18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Baby Boomers", ], "otros_trab")
promedios_otrab_decil_Generación_X18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación X", ], "otros_trab")
promedios_otrab_decil_GeneracionZ18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Generación Z", ], "otros_trab")
promedios_otrab_decil_Millennials18 <- calcular_promedios_por_variable_adicional_decil(BD18[BD18$generacion == "Millennials", ], "otros_trab")
